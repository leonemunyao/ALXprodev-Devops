#!/bin/bash

# Api endpoint for Pikachu.
API_URL="https://pokeapi.co/api/v2/pokemon/pikachu"

DATA_FILE="data.json"
ERROR_FILE="errors.txt"

# Function to log errors with timestamp
log_error() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] ERROR: $1" >> "$ERROR_FILE"
}


# Function to make the API requests.
fetch_pokemon_data() {
    echo "Fetching data from $API_URL..."

    HTTP_CODE=$(curl -s -o "$DATA_FILE" -w "%{http_code}" "$API_URL")

    if [ $? -eq 0 ]; then
        if [ "$HTTP_CODE" -eq 200 ]; then
            echo "Data fetched successfully! Pikachu data saved to $DATA_FILE."
            echo "HTTP Response Code: $HTTP_CODE"
        else
            log_error "Failed to fetch data from $API_URL. HTTP code: $HTTP_CODE"
            echo "An error occurred while fetching data. Check $ERROR_FILE for details."
            exit 1
        fi
    else
        log_error "Curl command failed."
        echo "Error: Failed to make API request. Check $ERROR_FILE for details."
        exit 1
    fi
}

echo "Starting Pokemon API Automation Script..."
echo "Target Pokemon: Pikachu."
echo "API URL: $API_URL"
echo "------------------------------"


fetch_pokemon_data


if [ -f "$DATA_FILE" ] && [ -s "$DATA_FILE" ]; then
    echo "--------------------------------"
    echo "Task completed successfully!"
    echo "Data file: $DATA_FILE ($(wc -c < "$DATA_FILE") bytes)"
else
    echo "--------------------------------"
    echo "Task failed. Check $ERROR_FILE for errors."
fi
